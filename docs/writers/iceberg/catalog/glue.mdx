---
title: 1. AWS Glue
description: AWS Glue Catalog configuration for OLake Apache Iceberg
sidebar_position: 2
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
import GlueIcebergWriterConfig from '@site/docs/shared/config/GlueIcebergWriterConfig.mdx';
import GlueIcebergWriterUIConfigDetails from '@site/docs/shared/config/GlueIcebergWriterUIConfigDetails.mdx';
import GlueIcebergWriterCLIConfigDetails from '@site/docs/shared/config/GlueIcebergWriterCLIConfigDetails.mdx';

# AWS Glue Catalog Write Guide

OLake integrates with AWS Glue Catalog to provide full support for **Apache Iceberg tables**.
This setup ensures that:
- **Data** is stored in Amazon S3 (Parquet + metadata files)
- **Metadata** is managed in AWS Glue Catalog (schemas, partitions, table properties)
- **OLake** seamlessly writes into Iceberg tables through Glue APIs

## Prerequisites

Before configuring OLake with AWS Glue Catalog, ensure the following are set up:

#### 1. Amazon S3 Bucket

- Create an S3 bucket in the same **AWS region** as your Glue Catalog.
- Example: `s3://olake-iceberg/`

#### 2. AWS IAM Permissions

- Create an IAM role or user with **Glue + S3 access**.

```json title="IAM Policy"
{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Sid": "GlueAccess",
            "Effect": "Allow",
            "Action": [
                "glue:CreateTable",
                "glue:CreateDatabase",
                "glue:GetTable",
                "glue:GetDatabase",
                "glue:GetDatabases",
                "glue:SearchTables",
                "glue:UpdateDatabase",
                "glue:UpdateTable"
            ],
            "Resource": [
                "arn:aws:glue:<REGION>:<ACCOUNT_ID>:catalog",
                "arn:aws:glue:<REGION>:<ACCOUNT_ID>:database/{AWS_GLUE_DATABASE_NAME}",
                "arn:aws:glue:<REGION>:<ACCOUNT_ID>:table/{AWS_GLUE_DATABASE_NAME}/*"
            ]
        },
        {
            "Sid": "S3BucketReadWrite",
            "Effect": "Allow",
            "Action": [
                "s3:ListBucket",
                "s3:GetBucket*",
                "s3:*Object"
            ],
            "Resource": [
                "arn:aws:s3:::{S3_BUCKET_NAME}",
                "arn:aws:s3:::{S3_BUCKET_NAME}/*"
            ]
        },
        {
            "Sid": "ListAllBuckets",
            "Effect": "Allow",
            "Action": "s3:ListAllMyBuckets",
            "Resource": "*"
        }
    ]
}
```

:::info **IAM Policy Notes**
- Replace `<REGION>`, `<ACCOUNT_ID>`, `{AWS_GLUE_DATABASE_NAME}`, and `{S3_BUCKET_NAME}` with your actual values
- If you already have databases and tables in Glue Catalog, you can remove `CreateDatabase` and `CreateTable` permissions
- The `SearchTables` permission is optional and used for table discovery operations
- **Note**: Drop table or delete table permissions are not included. Add `glue:DeleteTable` if you need table deletion capabilities
:::

## Configuration

<Tabs>

<TabItem value="glue-ui" label="OLake UI" default>

After successfully setting up the source, you will need to set up your destination.

![AWS Glue UI Configuration](/img/docs/iceberg/catalog/glue/glue-catalog-olake-ui-setup-destination.png)

<GlueIcebergWriterUIConfigDetails/>

**Click `Next ->`** to test the connection and verify that OLake can validate both Glue Catalog and S3 access.

</TabItem>

<TabItem value="glue-cli" label="OLake CLI">

Create a `destination.json` file with the following configuration:

<GlueIcebergWriterConfig/>

<GlueIcebergWriterCLIConfigDetails/>

Using this `destination.json`, you can run the sync command.

</TabItem>

</Tabs>

:::tip **Connection Testing**
OLake will automatically test:
- AWS credentials validity
- S3 bucket access permissions
- Glue Catalog connectivity
- Database creation/access permissions
:::

## Querying Data

:::info **Query Your Data with AWS Athena**
Once OLake has written data to Iceberg tables in AWS Glue Catalog, you can query the data using AWS Athena:

```sql
SELECT * FROM "ICEBERG_DATABASE_NAME"."TABLE_NAME" LIMIT 10;
```
:::

## Troubleshooting

### Common Errors & Solutions

| Error | Cause | Resolution |
|-------|-------|------------|
| `AccessDeniedException` | IAM role lacks permissions | Ensure Glue + S3 permissions in IAM policy |
| `NoSuchBucket` | S3 bucket doesn't exist or wrong region | Verify bucket exists and region matches config |
| `Database does not exist` | Glue database not found | OLake will create it automatically with proper permissions |
| `InvalidInputException` | Invalid S3 path format | Ensure S3 path follows format: `s3://bucket-name/prefix/` |

### Debugging Checklist

1. **Verify AWS Identity**:
   ```bash
   aws sts get-caller-identity
   ```

2. **List Glue Databases**:
   ```bash
   aws glue get-databases --region <your-region>
   ```

3. **Check S3 Bucket Access**:
   ```bash
   aws s3 ls s3://your-bucket-name/
   ```

4. **Test Glue Catalog Permissions**:
   ```bash
   aws glue get-database --name your-database-name --region <your-region>
   ```
