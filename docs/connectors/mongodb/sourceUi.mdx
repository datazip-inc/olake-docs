# MongoDB Source Documentation (UI)

## A. Setup Prerequisites

Before beginning, ensure the following are installed and running:

- Docker and Docker Compose (latest version)
- MongoDB instance (local or remote) with credentials ready to act as source

### Required Components
- Olake Docker Image: `olakego/source-mongodb:latest`
- Iceberg REST Catalog service: `http://host.docker.internal:8181/catalog`
- MinIO/S3 bucket for storage: `http://host.docker.internal:9000`
- Spark SQL or Trino (with Iceberg Catalog configured) for querying.

### Additional Note: CDC Requirements for MongoDB
If you want Olake to continuously capture new changes (CDC mode), MongoDB must:
- Be started in replica set mode (`--replSet rs0`).
- Have oplog enabled (automatic in replica sets).
- Have a user with both:
  - `readWrite` role on your database, and
  - `read` role on the local database (to read oplog).

### Steps for CDC Setup

#### 1. Run MongoDB in Replica Set Mode
By default, MongoDB runs as a standalone server → this does not have an oplog. You need to start it with Replica Set Name.

If MongoDB is running inside Docker then execute:

```bash
docker run -d --name mongodb  -p 27017:27017  mongo:6.0 --replSet rs0
```

If MongoDB is running outside Docker then execute:

```bash
mongod --replSet rs0 --bind_ip_all
```

#### 2. Initialize Replica Set
Once MongoDB is running, you must initialise the replica set (just starting with `--replSet` is not enough).

Open a Mongo shell:

```bash
docker exec -it mongodb mongosh
```

Then run:

```bash
rs.initiate()
```

You should see something like:

```bash
{ "ok" : 1 }
```

✅ Now your MongoDB has a replica set and oplog enabled.

#### 3. Create a User
Olake needs a user that can:
- Read/write your application database (to ingest data).
- Read from the local database (where oplog is stored).

Create the user in the `admin` database:

```javascript
use admin
db.createUser({
  user: "olake_user",
  pwd: "your_password",
  roles: [
    { role: "readWrite", db: "your_db" },
    { role: "read", db: "local" }
  ]
})
```

#### 4. Verify oplog
Check that the oplog collection exists:

```javascript
use local
show collections
db.oplog.rs.findOne()
```

If you see an entry, ✅ oplog is working.

---

## B. Configuration

### Create MongoDB Source Setup via Olake UI
1. Open Olake Web Console → [https://localhost:8000](https://localhost:8000)
2. Login with `Username: admin` / `Password: password`
3. Go to **Sources → + Create Source**.
4. Select **MongoDB** from the list.
5. Fill connection details.
6. Save changes.

The following image shows the Olake UI configuration screen. Use it as a reference to provide MongoDB connection details when creating the source:

![Olake UI MongoDB Source Setup](/img/connectors/mongodb/mongodb-ui-setup.png)

**Description of above parameters:**

| Field | Description | Example Value | Data Type |
|-------|-------------|---------------|-----------|
| `hosts` | List of MongoDB hosts. Use DNS SRV if `srv = true`. | `x.xxx.xxx.120:27017`, `x.xxx.xxx.120:27017`, `x.xxx.xxx.133:27017` (can be multiple) | STRING[] |
| `username`/`password` | Credentials for MongoDB authentication. | `"test"`/`"test"` | STRING |
| `authdb` | Authentication database (often `admin`). | `"admin"` | STRING |
| `replica_set` | Name of the replica set, if applicable. | `"rs0"` | STRING |
| `read_preference` | Which node to read from (e.g., `secondaryPreferred`). | `"secondaryPreferred"` | STRING |
| `srv` | If using DNS SRV connection strings, set to `true`. When `true`, there can only be 1 host in `hosts` field. | If `true`, the `hosts` key will have a value something like `["mongodatatest.pigiy.mongodb.net"]` | `true`, `false` | BOOL |
| `database` | The MongoDB database name to replicate. | `"database_name"` | STRING |
| `max_threads` | Maximum parallel threads for chunk-based snapshotting. | `5` | INT |
| `backoff_retry_count` | Retries attempt to establish sync again if it fails, increases exponentially (in minutes - 1, 2, 4, 8, 16... depending upon the `backoff_retry_count` value) | defaults to 3, takes default value if set to -1 | INT |
| `chunking_strategy` | The chunking strategy for backfill `timestamp`, uses `splitVector` strategy if the field is left empty. Refer [here] for more details. | `timestamp`, uses `splitVector` strategy if the field is left empty. Refer [here](../../../blog/2025-05-07-what-makes-olake-fast#mongodb) for more details. | |

---

## C. Troubleshooting

| Issue              | Possible Cause                           | Solution                                |
|--------------------|------------------------------------------|-----------------------------------------|
| Connection failed  | Wrong host/port, Mongo not running       | Check MongoDB is up and accessible.     |
| CDC not working    | Mongo not in replica set / oplog missing | Verify replica set is active with `rs.status()` |

---

## D. ChangeLogs


