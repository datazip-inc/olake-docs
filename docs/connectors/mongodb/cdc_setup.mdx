# MongoDB CDC Setup

### Steps for CDC Setup

#### 1. Run MongoDB in Replica Set Mode
By default, MongoDB runs as a standalone server → this does not have an oplog. You need to start it with Replica Set Name.

If MongoDB is running inside Docker then execute:

```bash
docker run -d --name mongodb  -p 27017:27017  mongo:6.0 --replSet rs0
```

If MongoDB is running outside Docker then execute:

```bash
mongod --replSet rs0 --bind_ip_all
```

#### 2. Initialize Replica Set
Once MongoDB is running, you must initialise the replica set (just starting with `--replSet` is not enough).

Open a Mongo shell:

```bash
docker exec -it mongodb mongosh
```

Then run:

```bash
rs.initiate()
```

You should see something like:

```bash
{ "ok" : 1 }
```

✅ Now your MongoDB has a replica set and oplog enabled.

#### 3. Create a User
Olake needs a user that can:
- Read/write your application database (to ingest data).
- Read from the local database (where oplog is stored).

Create the user in the `admin` database:

```javascript
use admin
db.createUser({
  user: "olake_user",
  pwd: "your_password",
  roles: [
    { role: "readWrite", db: "your_db" },
    { role: "read", db: "local" }
  ]
})
```

#### 4. Verify oplog
Check that the oplog collection exists:

```javascript
use local
show collections
db.oplog.rs.findOne()
```

If you see an entry, ✅ oplog is working.
