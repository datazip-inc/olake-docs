---
title: Setup MongoDB via Docker Compose
description: Setup MongoDB via Docker Compose
sidebar_position: 3
---

# To spawn mongo replica set for unit tests


### How to Run MongoDB Unit Tests 
To run Mongo Unit tests, start the docker compose and initiate it:

Create Network `olake-test`:
```bash
docker network create olake-test    
```

Run docker container:
```bash
docker compose -f ./drivers/mongodb/docker-compose.yaml up -d  
bash ./drivers/mongodb/docker-compose-init.sh  
```

Then you can run mongo tests:
```bash
go test -tags -v ./drivers/mongodb/internal                  
```

Stop the mongodb instance:
```bash
docker compose -f ./drivers/mongodb/docker-compose.yaml down
```


```yaml title="drivers/mongodb/docker-compose.yaml"
# To spawn mongo replica set for unit tests
version: "3.7"

services:
  db:
    image: 'mongo:latest'
    environment: {"MONGO_INITDB_ROOT_USERNAME": "olake", "MONGO_INITDB_ROOT_PASSWORD": "olake"}
    command: "mongod --bind_ip_all --replSet rs0 --keyFile /etc/ssl/sample.key"
    entrypoint: ["bash", "-c", "chmod 400 /etc/ssl/sample.key; chown 999:999 /etc/ssl/sample.key; exec docker-entrypoint.sh $@"]
    ports:
      - "27017:27017"
    networks:
      - olake-test
    volumes:
      - ${PWD}/drivers/mongodb/test.key:/etc/ssl/sample.key
    healthcheck:
      test: ["CMD","mongosh", "--eval", "db.adminCommand('ping')"]
      interval: 5s
      timeout: 5s
      retries: 3
      start_period: 5s

networks:
  olake-test:
    name: olake-test
    external: true
```
